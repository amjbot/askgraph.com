SET SESSION storage_engine = "InnoDB";
SET SESSION time_zone = "+0:00";
ALTER DATABASE CHARACTER SET "utf8";

CREATE TABLE IF NOT EXISTS requests (
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    contact VARBINARY(500) NOT NULL,
    request TEXT NOT NULL,
    context TEXT NOT NULL,
    ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    KEY(contact)
);
CREATE TABLE IF NOT EXISTS request_responses (
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    request_id INT NOT NULL,
    contact VARBINARY(500) NOT NULL,
    comment TEXT NOT NULL,
    context TEXT NOT NULL,
    ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    KEY(request_id)
);
CREATE TABLE IF NOT EXISTS observations (
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    source TEXT NOT NULL,
    target TEXT NOT NULL,
    ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    KEY(source(300))
);
CREATE TABLE IF NOT EXISTS smtp_incoming (
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    peer VARBINARY(256) NOT NULL,
    mailfrom VARBINARY(256) NOT NULL,
    rcpttos VARBINARY(256) NOT NULL,
    ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    data TEXT NOT NULL
);
CREATE TABLE IF NOT EXISTS smtp_outgoing (
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    mailfrom VARBINARY(256) NOT NULL,
    rcpttos VARBINARY(256) NOT NULL,
    ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    data TEXT NOT NULL
);
